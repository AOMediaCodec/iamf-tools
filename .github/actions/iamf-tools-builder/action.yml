name: iamf-tools-builder

description: Run unit tests for IAMF Tools.

inputs:
  platform:
    description: "The platform to build for."
    type: string
    default: linux

runs:
  using: composite
  steps:
    - shell: bash
      run: |
        if [[ "${{inputs.platform}}" == "windows" ]]; then
          # Windows works best with a very short path as per https://bazel.build/configure/windows#long-path-issues.
          echo  "startup --output_user_root=C:/" >> .bazelrc
          # Disable some windows tests until some platform-specific bugs are fixed.
          TEST_FILTER=*:-*TestVector.ValidateTestSuite*:EncoderMainLibTest.*
        else
          TEST_FILTER=*
        fi
        bazelisk test -c opt iamf/... --test_filter=${TEST_FILTER}

